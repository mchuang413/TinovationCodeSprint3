<!DOCTYPE html>
<html>
<head>
    <title>gpt test</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
    <header class="bg-dark">
        <nav class="navbar navbar-dark">
            <div class="container d-flex justify-content-between">
                <a href="#" class="navbar-brand d-flex align-items-center">
                    <strong>GPT Test v1.01</strong>
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </nav>
    </header>
    <section class="jumbotron py-5">
        <div class="container">
            <h1 id="username">Welcome, .</h1>
            <div class="container mx-auto my-4">
                <p class="lead text-muted">Enter your request here:</p>
                <input type="text" class="form-control mb-3" id="message" placeholder="" value="" required>
                <a href="#" class="btn btn-primary my-2" id="send-to-chatgpt">Send to ChatGPT</a>
                <hr class="my-4">
                <h2 class="jumbotron-headings pixelated">Chat-log:</h2> <!-- Pixelated font class -->
                <ul id="chat-log" class="list-group">
                    <!-- Chat messages will be appended here -->
                </ul>
            </div>
        </div>
    </section>
    <script src="script.js"></script>
    <script>
        window.onload = fetchUsername();
        const chatLog = document.getElementById('chat-log');
        const message = document.getElementById('message');
        const normalButton = document.getElementById('send-to-chatgpt');
        
        normalButton.addEventListener('click', (e) => {
            e.preventDefault();
            const messageText = message.value;
            message.value = '';
            
            const listElement = document.createElement('li');
            listElement.classList.add('list-group-item');
            listElement.innerHTML = `
                <div class="message__text lead text-muted">You: ${messageText} </div>
            `;
            chatLog.appendChild(listElement);
            listElement.scrollIntoView({ behavior: "smooth" });

            const loadingElement = document.createElement('div');
            loadingElement.classList.add('message');
            loadingElement.classList.add('message--received');
            loadingElement.innerHTML = `
                <div class="message__text lead text-muted">ChatGPT: [Generating...] </div>
            `;
            chatLog.appendChild(loadingElement);
            chatLog.scrollTop = chatLog.scrollHeight;

            fetch('http://localhost:4000/dashboard/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: "The following is a message from a human who wants to complete a mission. The following message describes a goal the user wants to accomplish. \n Please respond like a counselor, inspiring, and concise manner. Please list out a few steps for the person to achieve their goal. Human: " + messageText
                })
            })
            .then(res => res.json())
            .then(data => {
                const responseMessage = data.message;
                const responseLines = responseMessage.split("\n");
                responseLines.forEach(line => {
                    const stepElement = document.createElement('li');
                    stepElement.classList.add('list-group-item');
                    stepElement.innerHTML = `
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="defaultCheck1">
                            <label class="form-check-label" for="defaultCheck1">
                                ${line}
                            </label>
                        </div>
                    `;
                    chatLog.appendChild(stepElement);
                    listElement.scrollIntoView({ behavior: "smooth" });
                });
            });
        });
    </script>
</body>
</html>
